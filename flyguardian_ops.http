# Use este arquivo com a extensao REST Client (Huachao Mao). Mantenha o servidor ativo, defina @accessToken e clique em "Send Request" sobre cada bloco.

@base = http://localhost:5000
@accessToken = eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGUzMDYwMDQ5ZDE2NDI4ZTdmMTNlMjYiLCJyb2xlIjoiY2xpZW50ZSIsImlhdCI6MTc1OTcwOTQyOSwiZXhwIjoxNzU5NzEwMzI5fQ.HHeVuYB3zuD8CUBWVjJhp7Id2HBt_V3eXlfFNn_V2xjnjxDP_F5hlSkkaZuZku8QYnBD-FIhGGfdkpGyiw8AHj6p5C8sHFY9mA-audgG9Z_LB50gvU9vzhV52HjrT0dbTGnzUgqgEogKZtefQif8KVjTznNI3OszKo2o1dg48g-MtDR9FGsWXBtjRZh5_ypHaopDxOM6DJPseJSRN8JqLHC9ggmwYf_reEdqplZoNDX86eaCx9ZZJ9KrxBxet5Yuc-nJDF8m1kkENyAD7bfSAz5uY7qE79_jysAwNlHxd4bxGHRo9mLM7MGGBglfxCItJJepZQaMpEXolOmCdwBevg

### Health
GET {{base}}/health
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Drones - Create (POST /drones)
# @name createDrone
POST {{base}}/drones
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "model": "Matrice 300 RTK",
  "serial": "FG-DRN-{{$timestamp}}",
  "batteryPct": 92,
  "status": "ativo",
  "name": "Falcon X1",
  "manufacturer": "DJI",
  "notes": "Unidade principal de patrulha"
}

### Drones - List (GET /drones)
# @name listDrones
GET {{base}}/drones
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Drones - Retrieve (GET /drones/:id)
# @name getDrone
GET {{base}}/drones/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Drones - Update (PATCH /drones/:id)
# @name updateDrone
PATCH {{base}}/drones/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "manutencao",
  "notes": "Revisao programada"
}

### Drones - Delete (DELETE /drones/:id)
# @name deleteDrone
DELETE {{base}}/drones/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Missions - Create (POST /missions)
# @name createMission
POST {{base}}/missions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Perimetro Oeste",
  "droneId": "{{createDrone.response.body.$.id}}",
  "waypoints": [
    { "lat": -23.5503, "lng": -46.6330, "alt": 110, "speed": 12 },
    { "lat": -23.5498, "lng": -46.6315, "alt": 112, "speed": 11 }
  ],
  "etaSeconds": 840,
  "status": "planejada",
  "notes": "Ronda noturna"
}

### Missions - List (GET /missions)
# @name listMissions
GET {{base}}/missions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Missions - Retrieve (GET /missions/:id)
# @name getMission
GET {{base}}/missions/{{createMission.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Missions - Update Status (PATCH /missions/:id/status)
# @name updateMissionStatus
PATCH {{base}}/missions/{{createMission.response.body.$.id}}/status
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "em_execucao",
  "approvedBy": "cco.marcos",
  "notes": "Autorizado pelo CCO"
}

### FlightHistory - Create (POST /flight-history)
# @name createFlightHistory
POST {{base}}/flight-history
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "missionId": "{{createMission.response.body.$.id}}",
  "droneId": "{{createDrone.response.body.$.id}}",
  "startedAt": "2025-01-10T23:00:00Z",
  "endedAt": "2025-01-10T23:25:00Z",
  "log": {
    "distanceKm": 6.1,
    "maxAltitudeMeters": 118,
    "windGustKts": 12,
    "notes": "Sem ocorrencias"
  }
}

### FlightHistory - List by mission (GET /flight-history)
# @name listFlightHistory
GET {{base}}/flight-history?missionId={{createMission.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

