# Use este arquivo com a extensao REST Client (Huachao Mao). Mantenha o servidor ativo, defina @accessToken e clique em "Send Request" sobre cada bloco.

@base = http://localhost:5000
@accessToken = eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGUzY2M5YTQ2MTBiMDdlNDIwZDVmNDUiLCJyb2xlIjoiY2xpZW50ZSIsImlhdCI6MTc1OTc1OTUxNywiZXhwIjoxNzU5NzYwNDE3fQ.c2VvFAxL4EJ8eQFhYDBwCXXw2T2xjJA5s0hWXqvgX3wv2tmV1B1LPz-aQ_6zpAYoev9IAkyrEbohH37Z_lSuWyzGg6W6UTW-cpC2l0owkLIt427cDR4xNe5FG09_BSjUj87a33PJDybwDqsDLRcyyRG-WNqnFm4SeRMts5Sgb6HBm9B7Qedzcq__-meAiOLxLwq5vjLInTMZja1O55vCmrBF-2MLMWIkqtHV5m6KqldYtTTB8pwPzMetfjUYELI-23o78QUVKBLv790r3alSFDpwDoyE4QAsBvrgSXzaQ97DmE1KRhwqELNIKosW0sMHZcoJMimbfxuiDTSyK30TOA

### Health
GET {{base}}/health
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Drones - Create (POST /drones)
# @name createDrone
POST {{base}}/drones
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "model": "Matrice 300 RTK",
  "serial": "FG-DRN-{{$timestamp}}",
  "batteryPct": 92,
  "status": "ativo",
  "name": "Falcon X1",
  "manufacturer": "DJI",
  "notes": "Unidade principal de patrulha"
}

### Drones - List (GET /drones)
# @name listDrones
GET {{base}}/drones
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Drones - Retrieve (GET /drones/:id)
# @name getDrone
GET {{base}}/drones/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Drones - Update (PATCH /drones/:id)
# @name updateDrone
PATCH {{base}}/drones/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "manutencao",
  "notes": "Revisao programada"
}

### Drones - Delete (DELETE /drones/:id)
# @name deleteDrone
DELETE {{base}}/drones/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Missions - Create (POST /missions)
# @name createMission
POST {{base}}/missions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Perimetro Oeste",
  "droneId": "{{createDrone.response.body.$.id}}",
  "waypoints": [
    { "lat": -23.5503, "lng": -46.6330, "alt": 110, "speed": 12 },
    { "lat": -23.5498, "lng": -46.6315, "alt": 112, "speed": 11 }
  ],
  "etaSeconds": 840,
  "status": "planejada",
  "notes": "Ronda noturna"
}

### Missions - List (GET /missions)
# @name listMissions
GET {{base}}/missions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Missions - Retrieve (GET /missions/:id)
# @name getMission
GET {{base}}/missions/{{createMission.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Missions - Update Status (PATCH /missions/:id/status)
# @name updateMissionStatus
PATCH {{base}}/missions/{{createMission.response.body.$.id}}/status
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "em_execucao",
  "approvedBy": "cco.marcos",
  "notes": "Autorizado pelo CCO"
}

### FlightHistory - Create (POST /flight-history)
# @name createFlightHistory
POST {{base}}/flight-history
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "missionId": "{{createMission.response.body.$.id}}",
  "droneId": "{{createDrone.response.body.$.id}}",
  "startedAt": "2025-01-10T23:00:00Z",
  "endedAt": "2025-01-10T23:25:00Z",
  "log": {
    "distanceKm": 6.1,
    "maxAltitudeMeters": 118,
    "windGustKts": 12,
    "notes": "Sem ocorrencias"
  }
}

### FlightHistory - List by mission (GET /flight-history)
# @name listFlightHistory
GET {{base}}/flight-history?missionId={{createMission.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Streaming — Start Session
# @name startStreamSession
POST {{base}}/stream/session
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "droneId": "{{createDrone.response.body.$.id}}"
}

### Streaming — Answer
POST {{base}}/stream/session/{{startStreamSession.response.body.$.data.sessionId}}/answer
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "sdpAnswer": "mock-answer"
}

### Streaming — ICE Candidate
POST {{base}}/stream/session/{{startStreamSession.response.body.$.data.sessionId}}/ice
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "candidate": "candidate-1"
}

### Telemetry — Send Frame
POST {{base}}/telemetry/{{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "lat": -23.5,
  "lng": -45.3,
  "alt": 120,
  "speed": 8,
  "batteryPct": 85,
  "heading": 270,
  "ts": "2025-10-06T13:15:00.000Z"
}

### Telemetry — Latest
GET {{base}}/telemetry/{{createDrone.response.body.$.id}}/latest
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Streaming — Stop Session
POST {{base}}/stream/session/{{startStreamSession.response.body.$.data.sessionId}}/stop
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reason": "Encerrado via REST Client"
}

### Streaming — Logs
GET {{base}}/stream/logs?droneId={{createDrone.response.body.$.id}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

